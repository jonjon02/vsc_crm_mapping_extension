CREATE VIEW cobra_mapping_json AS
SELECT
	f.USERLEVEL_NAME AS ColName,
	t.USERLEVEL_NAME AS TableName,
	STRING_ESCAPE(
		CONCAT(
		CONCAT(t.LOGICAL_NAME,'.',f.LOGICAL_NAME), 
		', ',
		'Type: ',
		CASE WHEN c.DATA_TYPE = 'nvarchar' THEN CONCAT(c.DATA_TYPE,'(',c.CHARACTER_MAXIMUM_LENGTH,')')
		ELSE c.DATA_TYPE END, ', ',
		'Null: ',
		c.IS_NULLABLE), 'json') AS ColDescr
FROM AP_FIELDINFOS f
JOIN AP_TABLES t
ON t.ID = f.TABLE_ID
JOIN  INFORMATION_SCHEMA.COLUMNS c
ON c.COLUMN_NAME = f.LOGICAL_NAME AND t.LOGICAL_NAME = c.TABLE_NAME
WHERE 
	TABLE_ID >= 2 