CREATE VIEW cobra_mapping_json AS
SELECT
	f.USERLEVEL_NAME AS ColNameUser,
	f.LOGICAL_NAME AS ColNameLogical,
	t.USERLEVEL_NAME AS TableNameUser,
	t.LOGICAL_NAME AS TableNameLogical,
	STRING_ESCAPE(
		CONCAT(
		'Type: ',
		CASE WHEN c.DATA_TYPE = 'nvarchar' THEN CONCAT(c.DATA_TYPE,'(',c.CHARACTER_MAXIMUM_LENGTH,')')
		ELSE c.DATA_TYPE END, ', ',
		'Null: ',
		c.IS_NULLABLE, ', ',
		'Default: ',
		CASE 
		WHEN c.COLUMN_DEFAULT IS NULL AND c.IS_NULLABLE = 'YES' THEN '''NULL'''
		WHEN c.COLUMN_DEFAULT IS NULL AND c.IS_NULLABLE = 'NO' THEN '''NEVER NULL'''
		ELSE c.COLUMN_DEFAULT END), 'json') AS ColDescr
FROM AP_FIELDINFOS f
JOIN AP_TABLES t
ON t.ID = f.TABLE_ID
JOIN  INFORMATION_SCHEMA.COLUMNS c
ON c.COLUMN_NAME = f.LOGICAL_NAME AND t.LOGICAL_NAME = c.TABLE_NAME
WHERE 
	TABLE_ID >= 2
